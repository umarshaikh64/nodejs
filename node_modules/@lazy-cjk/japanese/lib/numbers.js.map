{"version":3,"file":"numbers.js","sourceRoot":"","sources":["numbers.ts"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nimport extend from 'lodash/defaults';\nimport Big from 'big.js';\nimport {\n\tpredefineedTranscriptionConfigs,\n\ttranscriptionConfigs,\n\tMIN_SAFE_INTEGER,\n\tMAX_SAFE_INTEGER,\n} from './data/numbers';\nimport { getBits, getBit } from './util/numbers';\n\nexport * from './data/numbers';\n\nexport function transcribeNumber(number: number | string, config?): string\n{\n\tif (typeof config === 'undefined')\n\t{\n\t\t// default config\n\t\tconfig = transcriptionConfigs['default'];\n\t}\n\n\tif (typeof config === 'string')\n\t{\n\t\tconfig = transcriptionConfigs[config];\n\n\t\tif (typeof config === 'undefined')\n\t\t{\n\t\t\tthrow new ReferenceError('Transcription method \"' + config + '\" is undefined');\n\t\t}\n\t}\n\n\tif (typeof config === 'object')\n\t{\n\t\tconfig = extend({}, config, transcriptionConfigs['default']);\n\t}\n\telse\n\t{\n\t\tthrow new Error('You specified unknown config to japanese.transcribeNumber');\n\t}\n\n\tif (typeof config.digits === 'string')\n\t{\n\t\tconfig.digits = predefineedTranscriptionConfigs.digits[config.digits];\n\n\t\tif (typeof config.digits === 'undefined')\n\t\t{\n\t\t\tthrow new ReferenceError('Transcription method of digits \"' + config.digits + '\" is undefined');\n\t\t}\n\t}\n\n\tif (typeof config.unitNames === 'string')\n\t{\n\t\tconfig.unitNames = predefineedTranscriptionConfigs.unitNames[config.unitNames];\n\n\t\tif (typeof config.unitNames === 'undefined')\n\t\t{\n\t\t\tthrow new ReferenceError('Transcription method of unitNames \"' + config.unitNames + '\" is undefined');\n\t\t}\n\t}\n\n\tif (typeof config.specialUnitNames === 'string')\n\t{\n\t\tconfig.specialUnitNames = predefineedTranscriptionConfigs.specialUnitNames[config.specialUnitNames];\n\n\t\tif (typeof config.specialUnitNames === 'undefined')\n\t\t{\n\t\t\tthrow new ReferenceError('Transcription method of specialUnitNames \"' + config.specialUnitNames + '\" is undefined');\n\t\t}\n\t}\n\n\tif (typeof config.smallUnitNames === 'string')\n\t{\n\t\tconfig.smallUnitNames = predefineedTranscriptionConfigs.smallUnitNames[config.smallUnitNames];\n\n\t\tif (typeof config.smallUnitNames === 'undefined')\n\t\t{\n\t\t\tthrow new ReferenceError('Transcription method of smallUnitNames \"' + config.smallUnitNames + '\" is undefined');\n\t\t}\n\t}\n\n\t// Unify input to string\n\n\tif (typeof number === 'number')\n\t{\n\t\tif (MIN_SAFE_INTEGER <= number && number < MAX_SAFE_INTEGER)\n\t\t{\n\t\t\tnumber = number.toString();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Paste number into binary form\n\t\t\tconst buf = Buffer.alloc(8);\n\t\t\tbuf.writeDoubleBE(number, 0);\n\n\t\t\tlet sign = getBit(buf, 0);\n\t\t\tlet exponent = getBits(buf, 1, 11) as any as number;\n\t\t\tlet mantissa = getBits(buf, 12, 52);\n\t\t\tlet fraction: Big = null;\n\n\t\t\texponent = parseInt(exponent.toString());\n\n\t\t\tif (exponent === 0)\n\t\t\t{\n\t\t\t\tfraction = mantissa;\n\t\t\t\texponent = 1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfraction = (new Big(2)).pow(52).plus(mantissa);\n\t\t\t}\n\n\t\t\tnumber = fraction.times((new Big(2)).pow(exponent - 1023 - 52)).toFixed();\n\n\t\t\tif (sign)\n\t\t\t{\n\t\t\t\tnumber = '-' + number;\n\t\t\t}\n\t\t}\n\t}\n\telse if (typeof number !== 'string')\n\t{\n\t\tthrow new ReferenceError('Type of `number` is unsupported');\n\t}\n\n\tlet length = number.length;\n\n\t// Main convertion starts here\n\n\tlet lit = '';\n\tlet restoreZero = false;\n\tif (config.unitNames.lit && length > config.unitNames.lit)\n\t{\n\t\tlit = number.slice(0, -config.unitNames.lit).split('').map(function (digit)\n\t\t{\n\t\t\treturn config.digits[digit];\n\t\t}).join('');\n\n\t\tnumber = number.slice(-config.unitNames.lit);\n\t\tlength = number.length;\n\t\tif (number[0] === '0')\n\t\t{\n\t\t\trestoreZero = true;\n\t\t\tnumber = '9' + number.slice(1);\n\t\t}\n\t}\n\n\t// handle zero\n\tif (number === '0')\n\t{\n\t\treturn config.digits[0];\n\t}\n\n\tlet transcription = '';\n\n\tif (number.slice(-1) !== '0')\n\t{\n\t\ttranscription += config.digits[(number as string).slice(-1)];\n\t}\n\n\t// Get sanitized unit name keys\n\tlet keysOfUnitNames = Object.keys(config.unitNames).map(function (key)\n\t{\n\t\t// convert to int\n\t\treturn parseInt(key);\n\t}).filter(function (key, index, self)\n\t{\n\t\t// unique\n\t\treturn self.indexOf(key) === index;\n\t}).filter(function (key)\n\t{\n\t\t// validate\n\t\treturn isFinite(key) && key > 0;\n\t}).sort(function (a, b)\n\t{\n\t\t// asc sort\n\t\treturn a - b;\n\t});\n\n\tkeysOfUnitNames.forEach(function (key, index)\n\t{\n\t\tlet nextKey = keysOfUnitNames[index + 1] || Infinity;\n\t\t// slice the digits spaned by the unit name\n\t\tlet token = (number as string).slice(Math.max(length - nextKey, 0), Math.max(length - key, 0));\n\n\t\tif (token.length > 0)\n\t\t{\n\t\t\t// check if every number in the token is zero\n\t\t\tif (!token.split('').every(function (digit) { return digit === '0'; }))\n\t\t\t{\n\t\t\t\t// truncateOne\n\t\t\t\tif (config.truncateOne.indexOf(config.unitNames[key]) !== -1 && parseInt(token) === 1)\n\t\t\t\t{\n\t\t\t\t\ttranscription = config.unitNames[key] + transcription;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttranscription = transcribeNumber(token, config) + config.unitNames[key] + transcription;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t// Rejoin lit tokens\n\tif (restoreZero)\n\t{\n\t\ttranscription = transcription.replace(new RegExp('^' + config.digits[9]), config.digits[0]);\n\t}\n\ttranscription = lit + transcription;\n\n\treturn transcription;\n}\n\nexport default transcribeNumber\n"]}