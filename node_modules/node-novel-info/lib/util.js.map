{"version":3,"file":"util.js","sourceRoot":"","sources":["util.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2020/1/16.\n */\n\nimport { filterByPrefixReturnKeys, anyToArray } from './index';\nimport { array_unique } from 'array-hyper-unique';\nimport { IOptionsParse, IMdconfMeta } from './types';\nimport { envVal } from 'env-bool';\nimport sortObjectKeys from 'sort-object-keys2';\nimport isPlainObject from 'is-plain-object';\n\nexport function getNovelTitleFromMeta(meta: IMdconfMeta): string[]\n{\n\tif (meta?.novel)\n\t{\n\t\tlet arr = [\n\t\t\t\t'title',\n\t\t\t\t'title_source',\n\t\t\t\t'title_jp',\n\t\t\t\t'title_ja',\n\t\t\t\t'title_zh',\n\t\t\t\t'title_tw',\n\t\t\t\t'title_cn',\n\t\t\t].concat(filterByPrefixReturnKeys('title_', meta.novel))\n\t\t\t.reduce(function (a, key: string)\n\t\t\t{\n\t\t\t\tif (key in meta.novel)\n\t\t\t\t{\n\t\t\t\t\ta.push(meta.novel[key])\n\t\t\t\t}\n\n\t\t\t\treturn a\n\t\t\t}, [])\n\t\t;\n\n\t\tif (meta.novel.series)\n\t\t{\n\t\t\tarr.push(meta.novel.series.name);\n\t\t\tarr.push(meta.novel.series.name_short);\n\t\t}\n\n\t\tarr = array_unique(arr.filter(v => v && ![\n\t\t\t'undefined',\n\t\t\t'長編 【連載】',\n\t\t\t'連載中',\n\t\t].includes(v)));\n\n\t\treturn arr;\n\t}\n\n\treturn [];\n}\n\nexport function sortKeys<T extends IMdconfMeta>(ret: T)\n{\n\t// @ts-ignore\n\tret = sortObjectKeys(ret, [\n\t\t'novel',\n\t\t'contribute',\n\t\t'options',\n\t]);\n\n\tsortSubKey('novel', [\n\t\t'title',\n\t\t'title_short',\n\t\t'title_zh',\n\t\t'title_zh1',\n\t\t'title_zh2',\n\t\t'title_en',\n\t\t'title_jp',\n\t\t'title_output',\n\t\t'title_other',\n\t\t'title_source',\n\t\t'author',\n\t\t'authors',\n\t\t'illust',\n\t\t'illusts',\n\t\t'source',\n\t\t'sources',\n\t\t'cover',\n\t\t'publisher',\n\t\t'publishers',\n\t\t'date',\n\t\t'status',\n\t\t'novel_status',\n\t\t'r18',\n\n\t\t'series',\n\n\t\t'preface',\n\t\t'tags',\n\t]);\n\n\tsortSubKey(['novel', 'tags'], null, true);\n\tsortSubKey('contribute', null, true);\n\tsortSubKey('options');\n\n\tfunction sortSubKey(key, sortList?: string[], unique?: boolean)\n\t{\n\t\tlet obj = ret;\n\t\tlet parent = obj;\n\n\t\t//console.log(obj, sortList);\n\n\t\tif (Array.isArray(key))\n\t\t{\n\t\t\t//console.log(key);\n\n\t\t\tlet _k;\n\n\t\t\tfor (let value of key)\n\t\t\t{\n\t\t\t\tif (!(value in obj))\n\t\t\t\t{\n\t\t\t\t\t//console.log(value, parent);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t_k = value;\n\n\t\t\t\tparent = obj;\n\t\t\t\tobj = parent[value];\n\t\t\t}\n\n\t\t\tkey = _k;\n\t\t}\n\t\telse if ((key in parent))\n\t\t{\n\t\t\tobj = parent[key];\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Array.isArray(obj))\n\t\t{\n\t\t\tobj.sort();\n\t\t\tparent[key] = obj;\n\t\t\tif (unique)\n\t\t\t{\n\t\t\t\tparent[key] = parent[key].filter(function (v)\n\t\t\t\t{\n\t\t\t\t\treturn v;\n\t\t\t\t});\n\n\t\t\t\tparent[key] = array_unique(parent[key]);\n\n\t\t\t\tif (parent[key].length == 1 && (parent[key][0] === null || typeof parent[key][0] == 'undefined'))\n\t\t\t\t{\n\t\t\t\t\tparent[key] = [];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\tif (isPlainObject(obj))\n\t\t{\n\t\t\tparent[key] = sortObjectKeys(obj, sortList);\n\t\t}\n\t}\n\n\t// @ts-ignore\n\treturn ret;\n}\n\nexport function chkInfo(ret: IMdconfMeta, options: IOptionsParse = {}): IMdconfMeta\n{\n\tif (!ret\n\t\t|| (\n\t\t\t(!options || !options.lowCheckLevel)\n\t\t\t&& (!ret.novel || !ret.novel.title)\n\t\t)\n\t)\n\t{\n\t\tif (options?.throw)\n\t\t{\n\t\t\tthrow new TypeError(`novel${(ret.novel ? '.title' : '')} not exists.`);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tif (ret.novel)\n\t{\n\t\t[\n\t\t\t'authors',\n\t\t\t'illusts',\n\t\t\t'tags',\n\t\t\t'sources',\n\t\t\t'publishers',\n\t\t].forEach(k =>\n\t\t{\n\t\t\tif (k in ret.novel)\n\t\t\t{\n\t\t\t\tret.novel[k] = anyToArray(ret.novel[k], true);\n\t\t\t}\n\t\t});\n\n\t\tif ('novel_status' in ret.novel)\n\t\t{\n\t\t\tret.novel.novel_status = envVal(ret.novel.novel_status);\n\n\t\t\tif (isHexValue(ret.novel.novel_status))\n\t\t\t{\n\t\t\t\tret.novel.novel_status = Number(ret.novel.novel_status);\n\t\t\t}\n\t\t}\n\t}\n\n\tif ('contribute' in ret)\n\t{\n\t\tret.contribute = anyToArray(ret.contribute, true);\n\t}\n\n\tif (!options.lowCheckLevel)\n\t{\n\t\tret.options = ret.options || {};\n\t}\n\n\tif (ret.options)\n\t{\n\t\tif (typeof ret.options.textlayout === 'object')\n\t\t{\n\t\t\tObject.entries(ret.options.textlayout)\n\t\t\t\t.forEach(([k, v]) => ret.options.textlayout[k] = envVal(v))\n\t\t\t;\n\t\t}\n\n\t\tif (typeof ret.options.downloadOptions === 'object')\n\t\t{\n\t\t\tObject.entries(ret.options.downloadOptions)\n\t\t\t\t.forEach(([k, v]) => ret.options.downloadOptions[k] = envVal(v))\n\t\t\t;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nexport function isHexValue(value: string | number)\n{\n\treturn typeof value === 'string' && /^0x[\\da-f]+$/i.test(value)\n}\n"]}