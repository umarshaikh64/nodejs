{"version":3,"file":"class.js","sourceRoot":"","sources":["class.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2019/1/21/021.\n */\nimport { parse, stringify } from './index';\nimport bind from 'lodash-decorators/bind';\nimport { filterByPrefixReturnValues } from './lib';\nimport { EnumNovelStatus } from './lib/const';\nimport cloneDeep from 'lodash/cloneDeep';\nimport { getNovelTitleFromMeta, chkInfo } from './lib/util';\nimport { cb_title_filter, arr_filter } from './lib/index';\nimport { IOptionsParse, IMdconfMeta, IMdconfMetaOptionsNovelSite } from './lib/types';\n\nexport type INodeNovelInfoOptions = IOptionsParse & {};\n\nconst defaultOptions: Readonly<INodeNovelInfoOptions> = Object.freeze({});\n\nexport class NodeNovelInfo<T extends IMdconfMeta>\n{\n\traw: T;\n\n\tpathMain?: string;\n\tnovelID?: string;\n\n\tconstructor(mdconf: T, options: INodeNovelInfoOptions = defaultOptions, ...argv)\n\t{\n\t\toptions = NodeNovelInfo.fixOptions(options);\n\n\t\tlet ret: T = cloneDeep(mdconf);\n\n\t\tif (options.chk || options.chk == null)\n\t\t{\n\t\t\tret = chkInfo(ret, options) as T;\n\t\t}\n\n\t\tif (options.throw || options.throw == null)\n\t\t{\n\t\t\tret = chkInfo(ret, options) as T;\n\n\t\t\tif (!ret)\n\t\t\t{\n\t\t\t\tthrow new Error('not a valid NovelInfo data');\n\t\t\t}\n\t\t}\n\n\t\tthis.raw = ret;\n\t}\n\n\t@bind\n\tstatic fixOptions(options?: INodeNovelInfoOptions)\n\t{\n\t\treturn Object.assign({}, defaultOptions, options || {})\n\t}\n\n\t@bind\n\tstatic create<T extends IMdconfMeta>(mdconf: T, options: INodeNovelInfoOptions = defaultOptions, ...argv)\n\t{\n\t\treturn new this(mdconf, options, ...argv)\n\t}\n\n\t@bind\n\tstatic createFromString(input: string | Buffer, options?: INodeNovelInfoOptions, ...argv)\n\t{\n\t\tif (typeof input != 'string')\n\t\t{\n\t\t\tinput = input.toString();\n\t\t}\n\n\t\toptions = this.fixOptions(options);\n\n\t\tlet json = parse(input, options);\n\n\t\treturn this.create(json, options, ...argv);\n\t}\n\n\tprotected _pathMain_base()\n\t{\n\t\tlet is_out: boolean = null;\n\t\tlet pathMain_base: string = undefined;\n\n\t\tif (this.pathMain != null)\n\t\t{\n\t\t\tlet _m = this.pathMain.match(/^(.+?)(_out)?$/);\n\n\t\t\tis_out = !!_m[2];\n\t\t\tpathMain_base = _m[1];\n\t\t}\n\n\t\treturn {\n\t\t\tis_out,\n\t\t\tpathMain_base,\n\t\t}\n\t}\n\n\tget is_out()\n\t{\n\t\treturn this._pathMain_base().is_out;\n\t}\n\n\tget pathMain_base()\n\t{\n\t\treturn this._pathMain_base().pathMain_base;\n\t}\n\n\t/**\n\t * 取得小說標題\n\t */\n\ttitle(...titles: string[]): string\n\t{\n\t\tlet novel = this.raw.novel;\n\n\t\tlet arr = [\n\t\t\tnovel.title_output,\n\t\t\tnovel.title_zh,\n\t\t\tnovel.title_short,\n\t\t\tnovel.title_tw,\n\n\t\t\t...titles,\n\t\t\tnovel.title,\n\n\t\t\tnovel.title_source,\n\n\t\t\tnovel.title_jp,\n\t\t\t// @ts-ignore\n\t\t\tnovel.title_ja,\n\t\t\tnovel.title_cn,\n\t\t];\n\n\t\tfor (let v of arr)\n\t\t{\n\t\t\tif (cb_title_filter(v))\n\t\t\t{\n\t\t\t\treturn v;\n\t\t\t}\n\t\t}\n\n\t\treturn this.titles()[0]\n\t}\n\n\t/**\n\t * 取得所有小說標題\n\t */\n\ttitles(): string[]\n\t{\n\t\treturn getNovelTitleFromMeta(this.raw)\n\t\t\t.filter(cb_title_filter)\n\t}\n\n\t/**\n\t * 取得系列名稱\n\t */\n\tseries_titles(): string[]\n\t{\n\t\treturn arr_filter([\n\t\t\tthis.raw.novel?.series?.name,\n\t\t\tthis.raw.novel?.series?.name_short,\n\t\t].concat([]))\n\t\t\t.filter(cb_title_filter)\n\t}\n\n\t/**\n\t * 取得作者列表\n\t */\n\tauthors(): string[]\n\t{\n\t\treturn arr_filter([\n\t\t\tthis.raw.novel?.author,\n\t\t].concat(this.raw.novel.authors || []))\n\t}\n\n\t/**\n\t * 取得繪師列表\n\t */\n\tillusts(): string[]\n\t{\n\t\tlet novel = this.raw.novel;\n\n\t\tlet arr = arr_filter([\n\t\t\t\t'illust',\n\t\t\t\t'illusts',\n\t\t\t]\n\t\t\t.concat(Object.keys(novel))\n\t\t\t.reduce(function (a, key: string)\n\t\t\t{\n\t\t\t\tif (key.indexOf('illust') === 0)\n\t\t\t\t{\n\t\t\t\t\ta.push(key)\n\t\t\t\t}\n\n\t\t\t\treturn a\n\t\t\t}, [] as string[]))\n\t\t\t.reduce(function (a: string[], key: string)\n\t\t\t{\n\t\t\t\tlet v = novel[key];\n\n\t\t\t\tif (Array.isArray(v))\n\t\t\t\t{\n\t\t\t\t\ta.push(...v)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta.push(v)\n\t\t\t\t}\n\n\t\t\t\treturn a\n\t\t\t}, []) as string[]\n\t\t;\n\n\t\treturn arr_filter(arr).filter(cb_title_filter)\n\t}\n\n\t/**\n\t * 取得標籤列表\n\t */\n\ttags(): string[]\n\t{\n\t\treturn arr_filter(this.raw.novel?.tags || [])\n\t}\n\n\t/**\n\t * 取得貢獻者/翻譯者列表\n\t */\n\tcontributes(): string[]\n\t{\n\t\treturn arr_filter(this.raw.contribute || [])\n\t}\n\n\t/**\n\t * 取得發布網站名稱或者出版社名稱列表\n\t */\n\tpublishers(): string[]\n\t{\n\t\treturn arr_filter([\n\t\t\tthis.raw.novel?.publisher,\n\t\t].concat(this.raw.novel.publishers || []))\n\t}\n\n\t/**\n\t * 取得發布或者來源網址\n\t */\n\tsources()\n\t{\n\t\treturn arr_filter(filterByPrefixReturnValues<string>(/^source(?:_.+)?$/, this.raw.novel)\n\t\t\t.concat(this.raw.novel.sources || []))\n\t}\n\n\t/**\n\t * 小說來源的網站資料(請查閱 novel-downloader)\n\t */\n\tsites()\n\t{\n\t\treturn arr_filter(Object.entries(this.raw.options || {})\n\t\t\t.reduce(function (ls, [site, data])\n\t\t\t{\n\t\t\t\tif (data && ('novel_id' in data))\n\t\t\t\t{\n\t\t\t\t\tls.push({\n\t\t\t\t\t\tsite,\n\t\t\t\t\t\tdata,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\treturn ls;\n\t\t\t}, [] as {\n\t\t\t\tsite: string,\n\t\t\t\tdata: IMdconfMetaOptionsNovelSite,\n\t\t\t}[]));\n\t}\n\n\t/**\n\t * 取得小說狀態\n\t */\n\tstatus(): EnumNovelStatus | number\n\t{\n\t\treturn this.raw.novel?.novel_status\n\t}\n\n\ttoJSON<R>(clone?: boolean): R\n\ttoJSON(clone?: boolean): T\n\ttoJSON(clone?: boolean): T\n\t{\n\t\tif (clone)\n\t\t{\n\t\t\treturn cloneDeep(this.raw);\n\t\t}\n\n\t\t// @ts-ignore\n\t\treturn this.raw;\n\t}\n\n\tstringify()\n\t{\n\t\treturn stringify(this.raw)\n\t}\n\n\tstatic parse = parse;\n\tstatic stringify = stringify;\n}\n\nexport default NodeNovelInfo\n"]}